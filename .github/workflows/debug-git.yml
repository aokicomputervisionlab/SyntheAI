name: Debug Auto Push Test

on:
  workflow_dispatch: # 手動実行ボタン用

jobs:
  debug-push:
    runs-on: self-hosted
    container:
      # Gitが入っていない例のTFイメージをあえて使います
      image: tensorflow/tensorflow:2.15.0.post1-gpu 
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        # Git Actionを使う場合は、ここで権限を永続化しておくのがコツです
        with:
          persist-credentials: true

      - name: Modify File in Container
        run: |
          # Gitがなくてもできる「ファイル書き換え」だけを実行
          DATE=$(date +'%Y-%m-%d %H:%M:%S')
          echo "Last debug run: $DATE" > debug_log.txt
          echo "Container check: I don't have git, but I can write files!"
          
      - name: Auto Commit and Push
        # 【ここが魔法】コンテナの中のGitは使わず、Action側がプッシュを代行します
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "debug: container file update test (${{ github.run_number }})"
          file_pattern: 'debug_log.txt'
          commit_user_name: github-actions[bot]
          commit_user_email: github-actions[bot]@users.noreply.github.com
